<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<!--ICON CDN-->
	<link rel='stylesheet' href='https://cdn-uicons.flaticon.com/uicons-regular-rounded/css/uicons-regular-rounded.css'>
	<!--CSS-->
	<link rel="stylesheet" href="scss/all.css">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
	<title>跳跳商品詳情</title>
</head>

<body>
	<header class="bg-secondary text-white">
		<div class="container">
			<div class="d-flex flex-wrap align-items-center justify-content-center justify-content-lg-start">
				<!--LOGO-->
				<a class="navbar-brand" href="home.html">
					<img class="bi me-2" src="images/icon_1.png" alt="hopsellIcon" width="30" height="30">
				</a>
				<!--商品分類-->
				<ul class="nav col-12 col-lg-auto me-lg-auto mb-2 justify-content-center mb-md-0">
					<li><a href="#" class="nav-link px-2 text-white">商品分類1</a></li>
					<li><a href="#" class="nav-link px-2 text-white">商品分類2</a></li>
					<li><a href="#" class="nav-link px-2 text-white">商品分類3</a></li>
					<li><a href="#" class="nav-link px-2 text-white">商品分類4</a></li>
					<li><a href="#" class="nav-link px-2 text-white">商品分類5</a></li>
					<li><a href="#" class="nav-link px-2 text-white">商品分類6</a></li>
				</ul>
				<!--登出按鈕-->
				<div class="text-end">
					<a href="home.html" type="button" class="btn btn-secondary ">登出</a>
					<a href="register.html" type="button" class="btn btn-secondary">註冊</a>
				</div>
			</div>
		</div>
	</header>
	<!-- 搜尋列 -->
	<div class="navbar ">
		<div class="container">
			<!--LOGO-->
			<a href="home.html"><img src="https://upload.cc/i1/2021/08/13/xDSmVg.png" alt="hopsellIcon" height="32"></a>
			<!--搜尋-->
			<div>
				<div class="container-fluid">
					<form class="d-flex">
						<input class="form-control" type="search" placeholder="搜尋商品" aria-label="Search">
						<button class="btn btn-outline-success px- me-2" type="submit">Search</button>
					</form>
				</div>
			</div>
			<div class="d-flex">
				<a href="user_add.html" class="btn fw-bold btn-danger px-4 me-2">出售</a>
			</div>
		</div>
	</div>



	<!-- 內容 圖片 -->
	<div id="app">
		<div class="container container-fluid mt-3">
			<div class="row">
				<div class="col-md-12">
					<div class="row">
						<div class="col-md-4">
							<el-image :src="data.productImgA" :preview-src-list="[data.productImgA]"
								style="height: 440px; width: 100%;" fit="cover"></el-image>
						</div>
						<div class="col-md-4">
							<el-image :src="data.productImgB" :preview-src-list="[data.productImgA]"
								style="height: 440px; width: 100%;" fit="cover"></el-image>
						</div>
						<div class="col-md-4">
							<el-image :src="data.productImgC" :preview-src-list="[data.productImgA]"
								style="height: 440px; width: 100%;" fit="cover"></el-image>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!-- 內容 文字 -->

		<div class="container">
			<div class="row pt-5 ">
				<div class="col-md-12">
					<div class="row">
						<!-- 左內容 -->
						<div class="col-md-8 ">
							<!-- 商品訊息 -->
							<div>
								<h3>{{data.productName}}</h3>
								<p class="fs-1 text-danger">NT${{data.productPrice}}</p>
								<i class="bi bi-emoji-sunglasses fs-3 m-3"> {{data.productCondition}}</i>
								<i class="bi bi-people-fill fs-3 m-3">{{data.productTrade}}</i>
								<i class="bi bi-geo-alt-fill fs-3 m-3">南投縣 (Nantou)</i>
								<hr class="bg-dark border-4 border-top border-dark">
								<i class="bi bi-calendar-event-fill fs-3 m-3">發布日期: {{data.createTim}}</i>
								<p style="white-space: pre-line;" class="mt-3">{{data.productContent}}</p>
								<div class="pb-3">
									<button class="btn btn-danger" @click="tobuyProduct">立即購買</button>
								</div>
								<br>
							</div>
							<!-- 評價訊息 -->
							<div>
								<h3>賣家評價</h3>
								<hr class="bg-dark border-4 border-top border-dark">
								<table class="table table-hover table-borderless">
									<thead>
										<tr>
											<th width="100" scope="col">日期</th>
											<th width="200" class="" scope="col">買家</th>
											<th scope="col">購買商品</th>
											<th scope="col">評等</th>
											<th scope="col">評價</th>
										</tr>
									</thead>
									<tbody v-for="item in commList">
										<tr>
											<th scope="row">{{item.commTime}}</th>
											<td><img :src="item.buyerImg" class="rounded-circle" height="50" width="50">
												{{item.buyerName}}</td>
											<td>{{item.productName}}</td>
											<td>
												<el-rate v-model="item.commLevel" disabled show-score text-color="#ff9900">
												</el-rate>
											</td>
											<td>{{item.commContent}}</td>
										</tr>
									</tbody>
								</table>
							</div>
						</div>
						<!-- 右功能 -->
						<div class="col-md-4 px-5">
							<div class="card  text-center shadow">
								<el-image :src="data.sellerImg" class="card-img-top img-thumbnail p-1 " fit="cover"></el-image>
								<div class="card-block mt-2 p-2">
									<p class="card-title fs-3">
										{{data.sellerName}}
									</p>
									<div class="mt-3">
										<p class="card-text">
											<i class="bi bi-star-fill fs-5">尚無評價</i>
										</p>
									</div>
									<div class="p-2">
										<i class="bi bi-chat-dots-fill m-2 fs-5">很常回覆</i>
										<i class="bi bi-envelope-fill m-2 fs-5">已驗證</i>
									</div>
									<div class="mb-3">
										<label for="exampleFormControlTextarea1" class="form-label"></label>
										<textarea class="form-control" id="exampleFormControlTextarea1" rows="3"
											placeholder="留下給賣家的訊息"></textarea>
									</div>
									<div class="card-footer bg-secondary">
										<button type="button" data-bs-toggle="modal" data-bs-target="#addModal"
											class="btn btn-danger btn-block card-btn rounded-pill px-4 fs-6">
											與我聯絡
										</button>
									</div>
								</div>
							</div>
							<div class="d-flex justify-content-center pt-2">
								<button v-if="buyerId !== '' " class="btn btn-outline-secondary bi bi-flag"> Report this
									listing</button>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>


		<!-- 內容 你可能喜歡 -->
		<div>
			<div class="container">
				<div class="row pt-2 ">
					<div class="col-md-12">
						<div class="row">
							<!-- 左內容 商品區 -->
							<div class="col-md-8">
								<h3><i class="bi bi-suit-heart-fill">你可能也喜歡</i></h3>
								<hr class="bg-dark border-4 border-top border-dark">
								<div class="row">
									<!-- v-for -->
									<div v-for="item in storeList" class="col-md-3 mb-3">
										<div class="card pt-1">
											<p class="card-title d-flex ">
												<el-image class="rounded-circle mx-2" :src="item.sellerImg"
													style="height: 32px; width: 32px;" fit="cover"></el-image>
												@{{item.sellerName}}
											</p>
											<div>
												<el-image class="card-img-top img-thumbnail-like px-1" alt=""
													:src="item.productImgA" fit="cover"></el-image>
											</div>
											<div class="card-block">
												<div class="px-1">
													<p class="card-text fs-6 text-truncate">
														{{item.productName}}
													</p>
												</div>
												<div class="px-2 d-flex flex-column mb-2">
													<div>
														<p class="card-text fs-5 fw-bold">NT${{item.productPrice}}</p>
													</div>
													<p class="card-text">{{item.productCondition}}</p>
												</div>
												<div class="d-flex justify-content-between">
													<i @click="addFavorite(item)" type="button" class="btn rounded-pill bi btn-sm"
														:class="item.like ? 'bg-white text-danger bi-heart-fill':'bi-heart' ">
													</i>
													<a href="#top" @click="toProduct(item)" type="button"
														class="btn bg-white btn-sm bi bi bi-search">
														詳情</a>
												</div>
											</div>
										</div>
									</div>
								</div>
								<!-- 右邊留白 -->
							</div>
							<div class="col-md-4 ">
								<!-- 右邊留白 -->
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>






	<!-- 置底 -->
	<div class="bg-secondary text-light mt-5">
		<div class="container">
			<footer class="d-flex flex-wrap justify-content-between align-items-center py-3  border-top ">
				<p class="col-md-4 mb-0 text-reset">© 2021 Company, Inc</p>

				<a href="/"
					class="col-md-4 d-flex align-items-center justify-content-center mb-3 mb-md-0 me-md-auto link-dark text-decoration-none">
					<svg class="bi me-2" width="40" height="32">
						<use xlink:href="#bootstrap"></use>
					</svg>
				</a>

				<ul class="nav col-md-4 justify-content-end">
					<li class="nav-item"><a href="#" class="nav-link px-2 text-reset">Home</a></li>
					<li class="nav-item"><a href="#" class="nav-link px-2 text-reset">Features</a></li>
					<li class="nav-item"><a href="#" class="nav-link px-2 text-reset">Pricing</a></li>
					<li class="nav-item"><a href="#" class="nav-link px-2 text-reset">FAQs</a></li>
					<li class="nav-item"><a href="#" class="nav-link px-2 text-reset">About</a></li>
				</ul>
			</footer>
		</div>
	</div>










	<!-- bootstrap JS CDN-->
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
		crossorigin="anonymous"></script>
	<script src="https://unpkg.com/vue@next"></script>
	<!-- Vue CDN -->
	<script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
	<!-- axios -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"
		integrity="sha512-bZS47S7sPOxkjU/4Bt0zrhEtWx0y0CRkhEp8IckzK+ltifIIE9EMIMTuT/mEzoIMewUINruDBIR/jJnbguonqQ=="
		crossorigin="anonymous" referrerpolicy="no-referrer"></script>
	<!-- 引入樣式 -->
	<link rel="stylesheet" href="https://unpkg.com/element-plus@1.0.2-beta.71/lib/theme-chalk/index.css">
	<!-- 引入組件庫 -->
	<script src="https://unpkg.com/element-plus@1.0.2-beta.71/lib/index.full.js"></script>
	<!-- sweetalert2 -->
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

	<!-- Vue APP -->
	<script>
		const app = Vue.createApp({
			data() {
				return {
					baseUrl: 'http://localhost:9090',
					data: {},
					productId: 10,
					sellerId: 1,
					commList: [],
					storeList: [],
					favoriteList: [],
					reportList: [],
					buyerId: "1",
				}
			},
			methods: {
				// 讀取當前商品資料
				productLoad() {
					axios.get(`${this.baseUrl}/product/${this.productId}`).then(res => {
						// console.log(res.data.data)
						this.data = res.data.data;
					}).catch(err => {
						console.log(err);
					});
				},
				// 讀取評價資料
				commLoad() {
					axios.get(`${this.baseUrl}/comm`, {
						params: {
							sellerId: this.data.sellerId
						}
					}).then(res => {
						this.commList = res.data.data.records;
					}).catch(err => {
						console.log(err);
					});
				},
				// 讀取可能喜歡資料
				storeLoad() {
					axios.get(`${this.baseUrl}/product/all`).then(res => {
						// 過濾 刪除 & 下架
						const arr = res.data.data.filter(item => item.productStatus == 1)
						this.storeList = arr;
					}).catch(err => console.log(err));
				},
				// 加入最愛
				addFavorite(item) {
					// 先看清單中 是否有該商品
					const index = this.favoriteList.find(obj => obj.productId === item.productId)
					item.like = true;
					if (index) {
						Swal.fire('已經加到最愛囉!')
						return
					}
					this.favoriteList.push(item);
					Swal.fire({
						icon: 'success',
						title: '幫你加到最愛囉!',
						showConfirmButton: false,
						timer: 1500
					})
				},
				// 商品跳轉
				toProduct(item) {
					console.log(item.productId)
					this.data = item;
					sessionStorage.setItem("詳情", item.productId)
				},
				// 購買商品
				tobuyProduct() {
					if (this.buyerId == "") {
						Swal.fire('請先登入', '', 'info')
						return
					}
					Swal.fire({
						title: '確定要購買嗎',
						showCancelButton: true,
						icon: 'question',
						confirmButtonText: `確認`,
						cancelButtonText: '取消',
					}).then((result) => {
						if (result.isConfirmed) {
							axios.post(`${this.baseUrl}/order`, {
								productId: this.data.productId,
								buyerId: this.buyerId
							})
								.then((res) => {
									Swal.fire('購買成功', '', 'success')
								})
								.catch((err) => {
									console.log(err);
									Swal.fire('失敗', '', 'info')
								});
							setTimeout(() => {
								window.location.href = "user_store.html"
							}, 2000)
						}
					})
				},
			},
			mounted() {
				this.productId = sessionStorage.getItem('詳情') || 10;
				this.productLoad();
				this.commLoad();
				this.storeLoad();
				this.favoriteList = JSON.parse(localStorage.getItem('最愛清單')) || [];
			},
			// 監聽 favoriteList
			watch: {
				favoriteList: {
					handler() {
						localStorage.setItem('最愛清單', JSON.stringify(this.favoriteList));
					},
					deep: true,
				}
			}


		})

		app.use(ElementPlus);
		app.mount('#app')
	</script>







</body>

</html>